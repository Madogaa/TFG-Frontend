{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport http from 'axios';\nimport { bus } from '@/event-bus.js';\nimport { storage } from '../vuefire/firebase';\nimport { uploadBytes, ref } from 'firebase/storage';\nexport default {\n  name: 'ModalVue',\n  props: {\n    user: {\n      type: String,\n      required: true\n    },\n    idPerfil: {\n      type: Number,\n      required: true\n    }\n  },\n  data() {\n    return {\n      grados: [],\n      url: '',\n      selectGrado: {\n        idGrado: 0,\n        nombre: '',\n        asignaturaList: []\n      },\n      fileNames: [],\n      descripcion: '',\n      showSelected: false,\n      selectedAsignatura: false\n    };\n  },\n  mounted() {\n    this.getGrados();\n  },\n  methods: {\n    selected(data) {\n      this.showSelected = true;\n    },\n    selectingAsignatura() {\n      this.selectedAsignatura = true;\n    },\n    clickImagen(event) {\n      this.fileNames = [];\n      for (let i = 0; i < event.target.files.length; i++) {\n        this.fileNames.push(event.target.files[i]);\n        console.log(this.fileNames[i].name);\n      }\n    },\n    publicar() {\n      if (this.descripcion?.length === 0 | this.selectAsignatura == null | this.selectGrado == null | this.fileNames?.length === 0) {\n        this.close();\n        const errmsg = 'Porfavor rellene todos los campos antes de guardar cambios';\n        bus.emit('mostarError', errmsg);\n        return;\n      }\n      let imgRef;\n      for (let i = 0; i < this.fileNames.length; i++) {\n        imgRef = ref(storage, `publicacion/${this.user}/${this.fileNames[i].name}`);\n        uploadBytes(imgRef, this.fileNames[i]).then(e => console.log(e));\n      }\n      // eslint-disable-next-line node/handle-callback-err\n      return http.post('http://143.47.50.240:80/APIdotshare/publicacion', {\n        descripcion: this.descripcion,\n        idPerfil: this.idPerfil,\n        idAsignatura: this.selectAsignatura.idAsignatura\n      }).then(response => response.data).then(response => this.postFiles(response)).then(reponse => bus.emit('actualizarPublicaciones', false)).then(this.close()).catch(err => console.log(err));\n    },\n    postFiles(id) {\n      for (let i = 0; i < this.fileNames.length; i++) {\n        http.post('http://143.47.50.240:80/APIdotshare/archivo', {\n          idPublicacion: id,\n          dir: this.fileNames[i].name\n        }).then(response => response.data).then(response => console.log(response));\n      }\n    },\n    getGrados() {\n      return http({\n        method: 'GET',\n        url: 'http://143.47.50.240:80/APIdotshare/grados'\n      }).then(response => response.data).then(grados => {\n        this.grados = grados;\n      }).catch(err => console.log(err));\n    },\n    close() {\n      this.$emit('cierra', false);\n    }\n  }\n};","map":{"version":3,"names":["http","bus","storage","uploadBytes","ref","name","props","user","type","String","required","idPerfil","Number","data","grados","url","selectGrado","idGrado","nombre","asignaturaList","fileNames","descripcion","showSelected","selectedAsignatura","mounted","getGrados","methods","selected","selectingAsignatura","clickImagen","event","i","target","files","length","push","console","log","publicar","selectAsignatura","close","errmsg","emit","imgRef","then","e","post","idAsignatura","response","postFiles","reponse","catch","err","id","idPublicacion","dir","method","$emit"],"sources":["C:\\Users\\mario\\OneDrive\\Escritorio\\TFG-DOTSHARE\\TFG-DAM-mainn\\src\\views\\Modal.vue"],"sourcesContent":["<template>\n  <div class=\"modal show\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog\" role=\"document\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h5 class=\"modal-title\">Nueva Publicacion</h5>\n          <button @click=\"close\" type=\"button\" class=\"close\" aria-label=\"Close\">\n            <span aria-hidden=\"true\">&times;</span>\n          </button>\n        </div>\n        <form @submit.prevent=\"publicar\" enctype=\"multipart/form-data\">\n          <div class=\"modal-body\">\n            <div class=\"form__input\">\n              <p>Descripcion: </p>\n              <textarea v-model=\"descripcion\" name=\"descripcion\" id=\"\" cols=\"30\" rows=\"3\"></textarea>\n            </div>\n            <div class=\"form__input-file\">\n              <p>Upload: </p>\n              <input @change=\"clickImagen($event)\" type=\"file\" multiple accept=\"application/msword, application/vnd.ms-excel, application/vnd.ms-powerpoint,text/plain, application/pdf, image/*\" />\n            </div>\n            <select v-model=\"selectGrado\" v-on:change=\"selected\" class=\"form-select\" aria-label=\"Default select example\">\n              <option selected>Elije un grado</option>\n              <option v-for=\"grado in grados\" v-bind:key=\"grado.idGrado\"\n                v-bind:value=\"{ idGrado: grado.idGrado, nombre: grado.nombre }\">{{ grado.nombre }}</option>\n            </select>\n            <select v-on:change=\"selectingAsignatura\" v-model=\"selectAsignatura\" v-if=\"showSelected\" class=\"form-select\"\n              aria-label=\"Default select example\">\n              <option value=\"0\" selected>Elije Asignatura</option>\n              <option v-for=\"asignatura in  grados[selectGrado.idGrado - 1].asignaturaList\" v-bind:key=\"asignatura.idAsignatura\"\n                v-bind:value=\"{ idAsignatura: asignatura.idAsignatura, nombre: asignatura.nombre }\">{{ asignatura.nombre }}\n              </option>\n            </select>\n          </div>\n          <div class=\"modal-footer\">\n            <input type=\"submit\" class=\"btn btn-primary\" value=\"Save Changes\"/>\n            <button @click=\"close\" type=\"button\" class=\"btn btn-secondary\">Close</button>\n          </div>\n        </form>\n      </div>\n  </div>\n</div></template>\n\n<script>\nimport http from 'axios'\nimport { bus } from '@/event-bus.js'\nimport { storage } from '../vuefire/firebase'\nimport { uploadBytes, ref } from 'firebase/storage'\n\nexport default {\n  name: 'ModalVue',\n  props: {\n    user: {\n      type: String,\n      required: true\n    },\n    idPerfil: {\n      type: Number,\n      required: true\n    }\n  },\n  data () {\n    return {\n      grados: [],\n      url: '',\n      selectGrado: {\n        idGrado: 0,\n        nombre: '',\n        asignaturaList: []\n      },\n      fileNames: [],\n      descripcion: '',\n      showSelected: false,\n      selectedAsignatura: false\n    }\n  },\n  mounted () {\n    this.getGrados()\n  },\n  methods: {\n    selected (data) {\n      this.showSelected = true\n    },\n    selectingAsignatura () {\n      this.selectedAsignatura = true\n    },\n    clickImagen (event) {\n      this.fileNames = []\n      for (let i = 0; i < event.target.files.length; i++) {\n        this.fileNames.push(event.target.files[i])\n        console.log(this.fileNames[i].name)\n      }\n    },\n    publicar () {\n      if ((this.descripcion?.length === 0) | (this.selectAsignatura == null) | (this.selectGrado == null) | (this.fileNames?.length === 0)) {\n        this.close()\n        const errmsg = 'Porfavor rellene todos los campos antes de guardar cambios'\n        bus.emit('mostarError', errmsg)\n        return\n      }\n      let imgRef\n      for (let i = 0; i < this.fileNames.length; i++) {\n        imgRef = ref(storage, `publicacion/${this.user}/${this.fileNames[i].name}`)\n        uploadBytes(imgRef, this.fileNames[i])\n          .then(e => console.log(e))\n      }\n      // eslint-disable-next-line node/handle-callback-err\n      return http.post(\n        'http://143.47.50.240:80/APIdotshare/publicacion',\n        {\n          descripcion: this.descripcion,\n          idPerfil: this.idPerfil,\n          idAsignatura: this.selectAsignatura.idAsignatura\n        }\n      )\n        .then((response) => response.data)\n        .then(response => this.postFiles(response))\n        .then(reponse => bus.emit('actualizarPublicaciones', false))\n        .then(this.close())\n        .catch((err) => console.log(err))\n    },\n    postFiles (id) {\n      for (let i = 0; i < this.fileNames.length; i++) {\n        http.post(\n          'http://143.47.50.240:80/APIdotshare/archivo',\n          {\n            idPublicacion: id,\n            dir: this.fileNames[i].name\n          }\n        ).then(response => response.data)\n          .then(response => console.log(response))\n      }\n    },\n    getGrados () {\n      return http(\n        {\n          method: 'GET',\n          url: 'http://143.47.50.240:80/APIdotshare/grados'\n        }\n      )\n        .then((response) => response.data)\n        .then(grados => {\n          this.grados = grados\n        })\n        .catch((err) => console.log(err))\n    },\n    close () {\n      this.$emit('cierra', false)\n    }\n  }\n}\n</script>\n\n<style scoped>\n.show{\n  display: block;\n}\n.form-select{\n  margin: 0 0 1em 0;\n}\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}